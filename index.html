<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Redirecting...</title>
<style>
  .close-button {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #f0f0f0;
        transition: all 0.3s ease;
      }
      .close-button:hover {
        background-color: #e0e0e0;
        transform: scale(1.1);
      }
      .close-button:active {
        transform: scale(0.95);
      }
</style>
<script>
  const params = new URLSearchParams(window.location.search);
  
  const shortcut = params.get('name'); // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå
  const file = params.get('file');     // Obsidianãƒ•ã‚¡ã‚¤ãƒ«å
  const vault = params.get('vault');   // Obsidianä¿ç®¡åº«å
  const openApp = params.get('open');  // ã‚¢ãƒ—ãƒªèµ·å‹•ã®ã¿ç”¨

  // 1. ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆèµ·å‹•
  if (shortcut) {
    window.location.href = 'shortcuts://run-shortcut?name=' + encodeURIComponent(shortcut);
    document.body.innerHTML = "<h1>ğŸš€ " + shortcut + " ã‚’èµ·å‹•ä¸­...</h1>";
  } 
  // 2. Obsidianèµ·å‹•
  else if (file || vault || openApp) {
    let uri = 'obsidian://open';
    let queries = [];

    if (vault) queries.push('vault=' + encodeURIComponent(vault));
    if (file)  queries.push('file=' + encodeURIComponent(file));

    if (queries.length > 0) {
      uri += '?' + queries.join('&');
    }

    window.location.href = uri;
    document.body.innerHTML = "<h1>ğŸ’ Obsidianã‚’èµ·å‹•ã—ã¦ã„ã¾ã™...</h1>";
  }
  // 3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãªã—
  else {
    document.body.innerHTML = "ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br>?name=ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå<br>?file=ãƒãƒ¼ãƒˆå<br>?open=1";
  }

  // 5ç§’å¾Œã«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã‚‹ï¼ˆiOSã§ã¯å‹•ä½œã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€å¿µã®ãŸã‚å®Ÿè¡Œï¼‰
  setTimeout(function() {
    window.close();
  }, 5000);
</script>
</head>
<body>
  <body>
    <button class="close-button" onclick="window.close()">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
      </svg>
    </button>
</body>
</html>
