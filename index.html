<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Redirecting...</title>
<style>
  /* 1. å…¨ä½“ã‚’ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«ã™ã‚‹ */
  body {
    background-color: #111;
    color: #666;
    font-family: sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    text-align: center;
  }
  h1 { font-size: 1.2rem; font-weight: normal; }

  /* 2. Ã—ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .close-button {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 44px;
    height: 44px;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #333;
    color: #fff;
    transition: all 0.2s ease;
    -webkit-tap-highlight-color: transparent;
  }
  .close-button:active {
    transform: scale(0.9);
    background-color: #555;
  }
</style>
<script>
  const params = new URLSearchParams(window.location.search);
  
  // --- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾— ---
  const shortcut = params.get('name');       // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
  
  // Obsidianç”¨ (open -> obsidian ã«å¤‰æ›´)
  const file = params.get('file');           // Obsidianãƒ•ã‚¡ã‚¤ãƒ«
  const vault = params.get('vault');         // Obsidianä¿ç®¡åº«
  const openObsidian = params.get('obsidian'); // â˜…å¤‰æ›´: Obsidianèµ·å‹•
  
  // UpNoteç”¨
  const upnote = params.get('upnote');       
  const filterId = params.get('filter');      
  const notebookId = params.get('notebook');  

  // --- èµ·å‹•å‡¦ç† ---
  function launch() {
    let uri = '';
    let msg = '';

    // 1. ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
    if (shortcut) {
      uri = 'shortcuts://run-shortcut?name=' + encodeURIComponent(shortcut);
      msg = "ğŸš€ " + shortcut;
    } 
    // 2. UpNote
    else if (upnote || filterId || notebookId) {
      if (upnote === 'new') {
        uri = 'upnote://x-callback-url/note/new';
        msg = "ğŸ˜ æ–°è¦ãƒ¡ãƒ¢ä½œæˆ";
      } else if (filterId) {
        uri = 'upnote://x-callback-url/openFilter?filterId=' + encodeURIComponent(filterId);
        msg = "ğŸ˜ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é–‹ã";
      } else if (notebookId) {
        uri = 'upnote://x-callback-url/openNotebook?notebookId=' + encodeURIComponent(notebookId);
        msg = "ğŸ˜ ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã‚’é–‹ã";
      } else {
        uri = 'upnote://';
        msg = "ğŸ˜ UpNote";
      }
    }
    // 3. Obsidian (ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åã‚’å¤‰æ›´)
    else if (file || vault || openObsidian) {
      uri = 'obsidian://open';
      let queries = [];
      if (vault) queries.push('vault=' + encodeURIComponent(vault));
      if (file)  queries.push('file=' + encodeURIComponent(file));
      
      if (queries.length > 0) uri += '?' + queries.join('&');
      
      msg = "ğŸ’ Obsidian";
    }

    // --- å®Ÿè¡Œ ---
    if (uri) {
      document.getElementById('status').innerHTML = "<h1>" + msg + " ã‚’èµ·å‹•ä¸­...</h1>";
      window.location.href = uri;
      setTimeout(() => { window.close(); }, 5000);
    } else {
      document.getElementById('status').innerHTML = "ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼<br><small>?name=, ?obsidian=1, ?upnote=1 ãªã©</small>";
    }
  }

  window.onload = launch;
</script>
</head>
<body>
  <div id="status">Loading...</div>

  <button class="close-button" onclick="window.close()" aria-label="Close">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
      <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
    </svg>
  </button>
</body>
</html>
